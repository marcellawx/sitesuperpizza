<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super Pizza - Super Esfihas - Super Massas - Super Tudo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    .tab-active { border-bottom: 4px solid #ef4444; color: #ef4444; font-weight: bold; }
    .custom-scroll::-webkit-scrollbar { width: 8px; }
    .custom-scroll::-webkit-scrollbar-track { background: #fef3c7; }
    .custom-scroll::-webkit-scrollbar-thumb { background-color: #f87171; border-radius: 10px; border: 2px solid #fef3c7; }
    .cart-item-enter { animation: slide-in 0.3s ease-out forwards; }
    @keyframes slide-in { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    .modal-enter { animation: fade-in 0.3s ease-out forwards; }
    @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
    button { transition: transform 0.1s ease-in-out; }
    button:active { transform: scale(0.95); }
  </style>
</head>
<body class="bg-gradient-to-br from-yellow-50 via-red-50 to-yellow-100 min-h-screen flex flex-col font-sans">

<header id="header" class="bg-red-700 text-white p-4 shadow-xl">
  <div class="max-w-7xl mx-auto flex flex-col items-center">
    <div class="flex items-center gap-3">
      <i class="fas fa-pizza-slice text-3xl text-yellow-300"></i>
      <h1 class="text-3xl font-extrabold" style="font-family: 'Titan One', cursive;">Super Pizza</h1>
    </div>
    <div class="mt-3 text-center text-xs">
      <p class="font-semibold"><i class="fas fa-motorcycle mr-2 text-yellow-300"></i>Entrega grátis acima de R$ 35,00!</p>
      <p><i class="fas fa-credit-card mr-2 text-yellow-300"></i>Aceitamos cartões de refeição e alimentação</p>
    </div>
  </div>
</header>

<main class="flex-grow max-w-7xl mx-auto p-2 w-full">
  <nav class="mb-6 flex flex-wrap justify-center border-b-2 border-red-200">
    <button class="tab-button tab-active px-3 py-2 font-semibold text-sm" data-tab="promocoes">Promoções 🔥</button>
    <button class="tab-button px-3 py-2 font-semibold text-sm" data-tab="pizzas">Pizzas 🍕</button>
    <button class="tab-button px-3 py-2 font-semibold text-sm" data-tab="massas">Massas 🍝</button>
    <button class="tab-button px-3 py-2 font-semibold text-sm" data-tab="hamburgueres">Hambúrgueres 🍔</button>
    <button class="tab-button px-3 py-2 font-semibold text-sm" data-tab="esfihas">Esfihas 🥟</button>
    <button class="tab-button px-3 py-2 font-semibold text-sm" data-tab="combos">Combos 🍟</button>
    <button class="tab-button px-3 py-2 font-semibold text-sm" data-tab="bebidas">Bebidas 🥤</button>
    <button class="tab-button px-3 py-2 font-semibold text-sm" data-tab="contato">Contato 📞</button>
  </nav>
  
  <div>
    <section id="promocoes" class="tab-content block"></section>
    <section id="pizzas" class="tab-content hidden">
      <h2 class="text-2xl font-bold text-red-700 mb-4 border-l-4 border-red-500 pl-3">Nossas Pizzas 🍕</h2>
      <div class="bg-white p-4 rounded-lg shadow-lg">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">Monte sua Pizza! ✨</h3>
        <form id="buildPizzaForm" class="grid grid-cols-1 gap-6">
          <div>
            <div class="mb-4">
              <label class="block font-semibold mb-2 text-gray-700" for="pizzaSizes">1. Tamanho:</label>
              <select id="pizzaSizes" name="pizzaSize" required class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500"></select>
            </div>
            <div class="mb-4">
              <label class="block font-semibold mb-2 text-gray-700" for="bordaRecheada">2. Borda (Opcional):</label>
              <select id="bordaRecheada" name="bordaRecheada" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500"></select>
            </div>
            <div id="sodaSelectionContainer" class="space-y-4 mb-4"></div>
            <div>
              <label class="block font-semibold mb-2 text-gray-700">3. Sabores:</label>
              <div id="flavorsAccordion" class="space-y-2"></div>
              <p id="flavorWarning" class="text-red-600 text-sm mt-2 hidden"></p>
            </div>
          </div>
          <div class="bg-yellow-50 p-4 mt-4 rounded-lg shadow-inner border border-yellow-200">
            <h4 class="text-lg font-bold text-gray-800 mb-2 border-b pb-2">Resumo da Pizza</h4>
            <div class="text-sm">
              <p><strong>Tamanho:</strong> <span id="summarySize">--</span></p>
              <p><strong>Borda:</strong> <span id="summaryBorda">Nenhuma</span></p>
              <p id="summarySodaContainer" class="hidden"><strong>Bebida(s):</strong> <span id="summarySoda">--</span></p>
              <div class="mt-2">
                <p><strong>Sabores:</strong></p>
                <ul id="summaryFlavors" class="list-disc list-inside text-gray-700"><li>Selecione...</li></ul>
              </div>
            </div>
            <div class="mt-4 text-center">
              <p class="text-xl font-bold text-red-700 mb-2">Total: R$ <span id="pizzaTotal">0,00</span></p>
              <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">
                <i class="fas fa-cart-plus mr-2"></i> Adicionar
              </button>
            </div>
          </div>
        </form>
      </div>
    </section>
    <section id="massas" class="tab-content hidden"></section>
    <section id="hamburgueres" class="tab-content hidden"></section>
    <section id="esfihas" class="tab-content hidden"></section>
    <section id="combos" class="tab-content hidden"></section>
    <section id="bebidas" class="tab-content hidden"></section>
    <section id="contato" class="tab-content hidden"></section>
  </div>
</main>

<button id="floatingCartButton" class="hidden fixed bottom-4 right-4 bg-red-600 text-white p-3 rounded-full shadow-lg z-40 flex items-center">
  <i class="fas fa-shopping-cart text-xl"></i>
  <span id="floatingCartTotal" class="ml-2 bg-yellow-300 text-red-700 text-xs font-bold rounded-full px-2 py-1">R$ 0,00</span>
</button>

<div id="cartModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 modal-enter">
  <div class="bg-white rounded-lg shadow-2xl p-4 w-full max-w-md max-h-[90vh] flex flex-col">
    <div class="flex justify-between items-center border-b-2 border-red-200 pb-2 mb-4">
      <h3 class="text-xl font-bold text-red-700 flex items-center gap-3">
        <i class="fas fa-shopping-cart text-red-600"></i> Meu Pedido
      </h3>
      <button id="closeCartModal" class="text-gray-500 hover:text-red-600 text-2xl">&times;</button>
    </div>
    <div id="cartItems" class="flex-grow overflow-y-auto custom-scroll mb-4">
          </div>
    <div class="border-t-2 border-red-200 pt-4">
      <div class="mb-4">
        <div class="flex gap-2">
          <input type="text" id="couponInput" placeholder="Tem um cupom?" class="w-full p-2 border border-gray-300 rounded-md text-sm">
          <button id="applyCouponBtn" class="bg-gray-800 text-white px-4 rounded-md hover:bg-gray-700 text-sm font-bold">Aplicar</button>
        </div>
        <p id="couponMessage" class="text-xs mt-1"></p>
      </div>
      <div class="space-y-1 text-sm">
        <div class="flex justify-between items-center">
          <span class="text-gray-600">Subtotal:</span>
          <span id="cartSubtotal" class="text-gray-800 font-semibold">R$ 0,00</span>
        </div>
        <div id="discountContainer" class="hidden flex justify-between items-center text-green-600">
          <span class="font-semibold">Desconto:</span>
          <span id="discountAmount" class="font-semibold">- R$ 0,00</span>
        </div>
        <div id="deliveryFeeContainer" class="hidden flex justify-between items-center">
          <span class="text-gray-600">Taxa de Entrega:</span>
          <span id="cartDeliveryFee" class="font-semibold text-gray-800">R$ 8,00</span>
        </div>
        <div class="flex justify-between items-center border-t pt-2 mt-2">
          <span class="text-lg font-bold text-gray-800">Total:</span>
          <span id="cartTotal" class="text-xl font-bold text-red-700">R$ 0,00</span>
        </div>
      </div>
      <button id="checkoutButton" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg text-lg mt-4" disabled>
        <i class="fab fa-whatsapp"></i> Concluir Pedido
      </button>
    </div>
  </div>
</div>
  
<div id="checkoutModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 modal-enter">
  <div class="bg-white rounded-lg shadow-2xl p-4 w-full max-w-md max-h-[90vh] overflow-y-auto custom-scroll">
    <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">Quase lá! Faltam seus dados...</h2>
    <form id="customerInfoForm">
      <div class="mb-3">
        <label for="customerName" class="block text-gray-700 text-sm font-bold mb-1">Nome Completo:</label>
        <input type="text" id="customerName" class="shadow-sm appearance-none border rounded w-full py-2 px-3 text-gray-700" required>
      </div>
      <div class="grid grid-cols-1 gap-3 mb-3">
        <div>
          <label for="customerAddress" class="block text-gray-700 text-sm font-bold mb-1">Endereço (Rua e Nº):</label>
          <input type="text" id="customerAddress" class="shadow-sm appearance-none border rounded w-full py-2 px-3 text-gray-700" required>
        </div>
        <div>
          <label for="customerNeighborhood" class="block text-gray-700 text-sm font-bold mb-1">Bairro:</label>
          <input type="text" id="customerNeighborhood" class="shadow-sm appearance-none border rounded w-full py-2 px-3 text-gray-700" required>
        </div>
      </div>
      <div class="mb-3">
        <label for="customerObs" class="block text-gray-700 text-sm font-bold mb-1">Observações (opcional):</label>
        <textarea id="customerObs" class="shadow-sm appearance-none border rounded w-full py-2 px-3 text-gray-700" rows="2" placeholder="Ex: sem cebola, etc."></textarea>
      </div>
      <div class="border p-3 rounded-lg mb-4">
        <p class="block text-gray-700 text-sm font-bold mb-2">Sachês (Cortesia)</p>
        <div class="flex items-center justify-around">
          <div>
            <label for="ketchupQty" class="text-sm">Ketchup:</label>
            <input type="number" id="ketchupQty" min="0" max="10" value="0" class="w-16 text-center border rounded">
          </div>
          <div>
            <label for="mustardQty" class="text-sm">Mostarda:</label>
            <input type="number" id="mustardQty" min="0" max="10" value="0" class="w-16 text-center border rounded">
          </div>
        </div>
      </div>
      <div class="mb-4">
        <label for="paymentMethod" class="block text-gray-700 text-sm font-bold mb-1">Forma de Pagamento:</label>
        <select id="paymentMethod" class="shadow-sm appearance-none border rounded w-full py-2 px-3 text-gray-700" required>
          <option value="" disabled selected>Selecione</option>
          <option value="Vale Refeição/Alimentação">Vale Refeição/Alimentação</option>
          <option value="PIX">PIX</option>
          <option value="Cartão de Crédito">Cartão de Crédito</option>
          <option value="Cartão de Débito">Cartão de Débito</option>
          <option value="Dinheiro">Dinheiro</option>
        </select>
      </div>
      <div class="flex items-center justify-between gap-4 mt-6">
        <button type="button" id="cancelButton" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg w-1/2">Cancelar</button>
        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg w-1/2">Confirmar</button>
      </div>
    </form>
  </div>
</div>

<div id="promoModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 modal-enter">
  <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto custom-scroll">
    <h2 id="promoModalTitle" class="text-xl font-bold text-gray-800 mb-4 text-center">Personalize sua Promoção</h2>
    <form id="promoForm">
      <div id="promoSelectionContainer" class="space-y-6"></div>
      <div class="flex items-center justify-between gap-4 mt-8">
        <button type="button" id="cancelPromo" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg w-1/2">Cancelar</button>
        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg w-1/2">Adicionar</button>
      </div>
    </form>
  </div>
</div>
  
<div id="massaModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 modal-enter">
  <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-xl max-h-[90vh] overflow-y-auto custom-scroll">
    <h2 id="massaModalTitle" class="text-xl font-bold text-gray-800 mb-4 text-center">Monte sua Massa</h2>
    <form id="massaForm">
      <div id="massaSelectionContainer" class="space-y-6"></div>
      <p class="text-xl font-bold text-red-700 text-center mt-6">Total: R$ <span id="massaTotal">0,00</span></p>
      <div class="flex items-center justify-between gap-4 mt-8">
        <button type="button" id="cancelMassa" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg w-1/2">Cancelar</button>
        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg w-1/2">Adicionar</button>
      </div>
    </form>
  </div>
</div>

<div id="esfihaComboModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 modal-enter">
  <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto custom-scroll">
    <h2 id="esfihaComboModalTitle" class="text-xl font-bold text-gray-800 mb-4 text-center">Monte seu Combo</h2>
    <form id="esfihaComboForm">
      <div id="esfihaComboSelectionContainer" class="space-y-4"></div>
      <div id="esfihaComboSodaContainer" class="mt-6 space-y-4"></div>
      <div class="mt-4 p-3 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 rounded-lg">
        <p>Selecionadas: <span id="esfihaCounter">0</span> de <span id="esfihaTotalQty">0</span></p>
      </div>
      <p id="esfihaWarning" class="text-red-600 text-sm mt-2 hidden"></p>
      <p class="text-xl font-bold text-red-700 text-center mt-6">Total: R$ <span id="esfihaComboTotal">0,00</span></p>
      <div class="flex items-center justify-between gap-4 mt-8">
        <button type="button" id="cancelEsfihaCombo" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg w-1/2">Cancelar</button>
        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg w-1/2">Adicionar</button>
      </div>
    </form>
  </div>
</div>

<footer class="bg-red-800 text-yellow-100 p-6 mt-12">
  <div class="max-w-7xl mx-auto text-center">
    <div class="flex justify-center items-center gap-4 mb-4">
      <img src="https://i.imgur.com/83S4Y7g.png" alt="Sodexo" class="h-8">
      <img src="https://i.imgur.com/kM3T1fS.png" alt="VR Benefícios" class="h-10">
    </div>
    <p class="font-semibold">Super Pizza &copy; 2025</p>
    <p class="text-sm italic mt-2">"O Senhor é o meu pastor e nada me faltará"</p>
  </div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const data = {
        refrigerantesPromo: [ { nome: 'Guaraná Antarctica 1.5L (Grátis)', precoAdicional: 0 }, { nome: 'Kuat 2L (Grátis)', precoAdicional: 0 }, { nome: 'Pepsi 1.5L (Grátis)', precoAdicional: 0 }, { nome: 'Coca-Cola 2L', precoAdicional: 12.00 }, { nome: 'Pepsi 2L', precoAdicional: 5.00 }, { nome: 'Guaraná Antarctica 2L', precoAdicional: 5.00 } ],
        massaSizes: [ { nome: '400gr (serve 1 pessoa)', preco: 34.90 }, { nome: '1kg (serve até 3 pessoas)', preco: 59.90 } ],
        proteinasMassas: [ { nome: 'Presunto', precoAdicional: 0 }, { nome: 'Carne Moída', precoAdicional: 0 }, { nome: 'Frango', precoAdicional: 0 }, { nome: 'Carne Seca', precoAdicional: 10.00 }, { nome: 'Camarão', precoAdicional: 10.00 }, { nome: 'Bacalhau', precoAdicional: 10.00 } ],
        ingredientesMassas: [
            { nome: 'Alho', precoAdicional: 1.50 }, { nome: 'Atum', precoAdicional: 3.50 }, { nome: 'Bacon', precoAdicional: 3.50 }, { nome: 'Calabresa', precoAdicional: 2.50 }, { nome: 'Cebola', precoAdicional: 1.50 }, { nome: 'Lombo Canadense', precoAdicional: 3.50 }, { nome: 'Ovo', precoAdicional: 1.50 }, { nome: 'Palmito', precoAdicional: 3.50 }, { nome: 'Presunto', precoAdicional: 2.50 }, { nome: 'Salaminho', precoAdicional: 3.50 }, { nome: 'Tomate Seco', precoAdicional: 3.50 }
        ],
        molhosMassas: [ { nome: 'Molho ao Sugo' }, { nome: 'Molho Branco' }, { nome: 'Molho Quatro Queijos' } ],
        promocoes: [ { id: 'promo-combo-caixa', nome: 'Caixa Combo da Galera', desc: '4 X-Tudo, 5 pastéis e batata com cheddar e bacon.', preco: 90.00, preco_antigo: 120.00, needsFlavor: false, includesSoda: true }, { id: 'promo-media', nome: 'Pizza Média (32cm) Premiada', desc: 'Sua pizza média preferida com um preço especial.', preco: 52.00, preco_antigo: 60.00, needsFlavor: true, pizzas: [{ type: 'salgada', size: 'Média', maxSabores: 2 }] }, { id: 'promo-familia', nome: 'Combo Família Feliz', desc: '1 Pizza Família (2 sabores), 1 pizza doce individual e 1 refri.', preco: 90.00, needsFlavor: true, pizzas: [{ type: 'salgada', size: 'Família', maxSabores: 2 }], includesSweet: true, includesSoda: true }, { id: 'promo-gigante', nome: 'Combo Gigante Imbatível', desc: '1 Pizza Gigante (3 sabores), 1 pizza doce individual e 1 refri.', preco: 110.00, preco_antigo: 120.00, needsFlavor: true, pizzas: [{ type: 'salgada', size: 'Gigante', maxSabores: 3 }], includesSweet: true, includesSoda: true }, { id: 'promo-slim', nome: 'Promo Slim Gigante (47 cm)', desc: 'Sabor em tamanho gigante com um desconto incrível.', preco: 85.00, preco_antigo: 100.00, needsFlavor: true, pizzas: [{ type: 'salgada', size: 'Gigante', maxSabores: 3 }] }, { id: 'promo-2medias', nome: 'Dose Dupla: 2 Médias + 1 Doce', desc: '2 Pizzas Médias (2 sabores cada) e ganhe 1 brotão doce.', preco: 100.00, needsFlavor: true, pizzas: [{ type: 'salgada', size: 'Média 1', maxSabores: 2 }, { type: 'salgada', size: 'Média 2', maxSabores: 2 }], includesSweet: true } ],
        pizzas: {
            tamanhos: [ { nome: 'Individual (26cm)', preco: 30.00, maxSabores: 2, sodasInclusas: 0 }, { nome: 'Média (32cm)', preco: 50.00, maxSabores: 2, sodasInclusas: 0 }, { nome: 'Família (36cm)', preco: 75.00, maxSabores: 2, sodasInclusas: 1 }, { nome: 'Gigante (47cm)', preco: 90.00, maxSabores: 3, sodasInclusas: 1 }, { nome: 'Mega (70cm)', preco: 199.00, maxSabores: 5, sodasInclusas: 2 } ],
            bordas: [ { nome: 'Sem Borda', precoPadrao: 0.00 }, { nome: 'Catupiry', precoPadrao: 10.00, precoMega: 15.00, precoMedia: 7.00, precoIndividual: 5.00 }, { nome: 'Cheddar', precoPadrao: 10.00, precoMega: 15.00, precoMedia: 7.00, precoIndividual: 5.00 }, { nome: 'Cream Cheese', precoPadrao: 12.00, precoMega: 17.00, precoMedia: 9.00, precoIndividual: 7.00 }, { nome: 'Goiabada', precoPadrao: 12.00, precoMega: 17.00, precoMedia: 9.00, precoIndividual: 7.00 }, { nome: 'Doce de Leite', precoPadrao: 12.00, precoMega: 17.00, precoMedia: 9.00, precoIndividual: 7.00 } ],
            saboresSalgados: [ "Americana", "Atum", "Alho", "Bacon", "Bacalhau", "Benevento", "Calabresa", "Cebola", "Carioca", "Capricciosa", "Frango com Catupiry", "Frango com Cheddar", "La Pizza", "Marguerita", "Moda da Casa", "Mussarela", "Moda da Casa 2", "Napolitana", "Ovo", "Palmito", "Pizza de Batata", "Portuguesa", "4 Queijos", "Super Pizza", "Siciliana", "Tomate Seco", "Tropicaliente", "Lombo Canadense", "Presunto", "Salaminho" ],
            saboresDoces: [ "Banana com Canela", "Cocada Cremosa", "Prestígio", "Romeu & Julieta" ]
        },
        massas: [ { nome: 'Lasanha' }, { nome: 'Capeletti' }, { nome: 'Raviolli' }, { nome: 'Espaguete' }, { nome: 'Talharim' }, { nome: 'Nhoque' }, { nome: 'Penne' } ],
        hamburgueres: [ { nome: 'X-Duplo', desc: '2 Carnes, 2 ovos, queijo, presunto, bacon, calabresa, salada e molho.', preco: 17.00 }, { nome: 'X-Tudo', desc: 'Carne, ovo, queijo, presunto, bacon, calabresa, molho e salada.', preco: 14.00 }, { nome: 'X-Burguer Tropicaliente', desc: 'Carne, queijo, presunto, bacon, calabresa, molho e batata palha.', preco: 12.00 }, { nome: 'X-Egg', desc: 'Carne, queijo, ovo, salada e molho.', preco: 10.00 }, { nome: 'X-Burguer Kids', desc: 'Pão, carne, queijo, molho e batata palha.', preco: 5.00 }, { nome: 'X-Burguer Double Cheese', desc: 'Carne, presunto, dobro de catupiry e cheddar.', preco: 11.00 }, { nome: 'X-Bacon Lover', desc: 'Pão, carne, queijo e o dobro de bacon crocante.', preco: 11.00 } ],
        esfihas: {
            saboresComPreco: [ { nome: 'Carne 🥩', preco: 3.50, precoAdicional: 0 }, { nome: 'Queijo 🧀', preco: 3.50, precoAdicional: 0 }, { nome: 'Calabresa', preco: 3.50, precoAdicional: 0 }, { nome: 'Presunto', preco: 3.50, precoAdicional: 0.50 }, { nome: 'Milho 🌽', preco: 3.50, precoAdicional: 0.50 }, { nome: 'Atum', preco: 4.00, precoAdicional: 1.00 }, { nome: 'Mista', preco: 4.00, precoAdicional: 1.00 }, { nome: 'Frango c/ Catupiry', preco: 4.50, precoAdicional: 1.50 }, { nome: 'Calabresa c/ Catupiry', preco: 4.50, precoAdicional: 1.50 }, { nome: '4 Queijos 🧀', preco: 4.50, precoAdicional: 1.50 }, { nome: 'Tomate Seco 🍅', preco: 4.50, precoAdicional: 1.50 }, { nome: 'Portuguesa', preco: 4.50, precoAdicional: 1.50 }, { nome: 'Carne Seca', preco: 5.00, precoAdicional: 2.00 }, { nome: 'Bacalhau c/ Catupiry', preco: 5.00, precoAdicional: 2.00 }, { nome: 'Romeu & Julieta ❤️', preco: 3.50, precoAdicional: 0.50 }, { nome: 'Banana c/ Canela 🍌', preco: 3.50, precoAdicional: 0.50 }, { nome: 'Choco Duo 🍫', preco: 4.00, precoAdicional: 1.00 }, { nome: 'Prestígio 🥥🍫', preco: 4.00, precoAdicional: 1.00 }, { nome: 'Morango c/ Choco 🍓', preco: 4.50, precoAdicional: 1.50 }, { nome: 'Nutella 😍', preco: 5.00, precoAdicional: 2.00 } ],
            combos: [ { id: 'esfiha-combo-20', nome: 'Combo 20 Esfihas + Refri 2L', desc: 'Monte seu combo com 20 esfihas!', preco: 50.00, quantidade: 20, includesSoda: true, isCustomizable: true }, { id: 'esfiha-combo-15', nome: 'Combo 15 Esfihas', desc: 'Escolha 15 esfihas do seu jeito!', preco: 40.00, quantidade: 15, isCustomizable: true }, { id: 'esfiha-combo-30', nome: 'Combo 30 Esfihas', desc: 'Monte seu combo com 30 esfihas!', preco: 70.00, quantidade: 30, isCustomizable: true } ]
        },
        combos: [ { nome: 'Combo 1', desc: '4 X-Tudo + 25 salgados + Batata c/ Cheddar e Bacon', preco: 85.00, includesSoda: true }, { nome: 'Combo 2', desc: '100 Salgadinhos fritos grandes e sortidos', preco: 70.00 }, { nome: 'Combo 3', desc: '25 Salgados + Porção de Calabresa + Batata c/ Cheddar', preco: 85.00, includesSoda: true }, { nome: 'Combo 4', desc: '4 X-Tudo + 25 Salgados + Calabresa + Anéis de Cebola', preco: 85.00, includesSoda: true }, { nome: 'Combo 5', desc: '4 X-Tudo + 25 Salgados + Batata c/ Cheddar e Bacon', preco: 85.00, includesSoda: true }, { nome: 'Combo 6', desc: '4 X-Tudo + Calabresa Acebolada + Batata Frita + Anéis de Cebola', preco: 85.00, includesSoda: true }, { nome: 'Petisco Frango a Passarinho + Fritas', desc: 'Frango crocante com fritas. Inclui um refri!', preco: 60.00, includesSoda: true } ],
        bebidas: [ { nome: 'Refrigerante Lata 350ml', desc: 'Escolha seu sabor.', preco: 5.00 }, { nome: 'Refrigerante 2 Litros', desc: 'Para dividir com a galera!', preco: 12.00 } ]
    };
    const validCoupons = {"APPSUPERPIZZA": { type: "percentage", value: 10 }};
    let cart = [];
    let appliedCoupon = null;

    const cartItemsContainer = document.getElementById('cartItems');
    const cartSubtotalEl = document.getElementById('cartSubtotal');
    const deliveryFeeContainer = document.getElementById('deliveryFeeContainer');
    const cartDeliveryFeeEl = document.getElementById('cartDeliveryFee');
    const cartTotalEl = document.getElementById('cartTotal');
    const floatingCartButton = document.getElementById('floatingCartButton');
    const floatingCartTotal = document.getElementById('floatingCartTotal');
    const checkoutButton = document.getElementById('checkoutButton');
    const checkoutModal = document.getElementById('checkoutModal');
    const customerInfoForm = document.getElementById('customerInfoForm');
    const cancelButton = document.getElementById('cancelButton');
    const couponInput = document.getElementById('couponInput');
    const applyCouponBtn = document.getElementById('applyCouponBtn');
    const couponMessage = document.getElementById('couponMessage');
    const discountContainer = document.getElementById('discountContainer');
    const discountAmountEl = document.getElementById('discountAmount');
    const cartModal = document.getElementById('cartModal');
    const closeCartModal = document.getElementById('closeCartModal');
    const pizzaSizesEl = document.getElementById('pizzaSizes');
    const bordaRecheadaEl = document.getElementById('bordaRecheada');
    const flavorsAccordion = document.getElementById('flavorsAccordion');
    const flavorWarningEl = document.getElementById('flavorWarning');
    const summarySizeEl = document.getElementById('summarySize');
    const summaryBordaEl = document.getElementById('summaryBorda');
    const summarySodaContainer = document.getElementById('summarySodaContainer');
    const summarySoda = document.getElementById('summarySoda');
    const summaryFlavorsEl = document.getElementById('summaryFlavors');
    const pizzaTotalEl = document.getElementById('pizzaTotal');
    const buildPizzaForm = document.getElementById('buildPizzaForm');
    const sodaSelectionContainer = document.getElementById('sodaSelectionContainer');
    const promoModal = document.getElementById('promoModal');
    const promoForm = document.getElementById('promoForm');
    const cancelPromo = document.getElementById('cancelPromo');
    const massaModal = document.getElementById('massaModal');
    const massaForm = document.getElementById('massaForm');
    const cancelMassa = document.getElementById('cancelMassa');
    const esfihaComboModal = document.getElementById('esfihaComboModal');
    const esfihaComboForm = document.getElementById('esfihaComboForm');
    const cancelEsfihaCombo = document.getElementById('cancelEsfihaCombo');
    
    function formatCurrency(value) { return value.toFixed(2).replace('.', ','); }

    function updateCart() {
        cartItemsContainer.innerHTML = ''; 
        const subtotal = cart.reduce((sum, cartItem) => sum + (cartItem.product.preco * cartItem.quantity), 0);
        let deliveryFee = 0;
        let discount = 0;
        if (appliedCoupon && subtotal > 0) {
            if (appliedCoupon.type === 'percentage') { discount = subtotal * (appliedCoupon.value / 100); }
            discountContainer.classList.remove('hidden');
            discountAmountEl.textContent = `- R$ ${formatCurrency(discount)}`;
        } else { discountContainer.classList.add('hidden'); }
        const totalAfterDiscount = subtotal - discount;
        if (totalAfterDiscount > 0 && totalAfterDiscount < 35.00) {
            deliveryFee = 8.00;
            deliveryFeeContainer.classList.remove('hidden');
            cartDeliveryFeeEl.textContent = `R$ ${formatCurrency(deliveryFee)}`;
        } else { deliveryFeeContainer.classList.add('hidden'); }
        const finalTotal = totalAfterDiscount + deliveryFee;

        if (cart.length === 0) {
            cartItemsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Seu carrinho está vazio.</p>';
            checkoutButton.disabled = true;
            floatingCartButton.classList.add('hidden');
        } else {
            cart.forEach((cartItem, index) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'flex justify-between items-center mb-3 p-2 bg-gray-50 rounded cart-item-enter';
                itemEl.innerHTML = `
                    <div class="flex-grow pr-2">
                        <p class="font-bold text-sm text-gray-800">${cartItem.quantity}x ${cartItem.product.nome}</p>
                        ${cartItem.product.desc ? `<p class="text-xs text-gray-600">${cartItem.product.desc.replace(/ \| /g, ', ')}</p>` : ''}
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="flex items-center gap-1 border rounded-md p-1">
                            <button class="qty-change-btn text-red-500" data-index="${index}" data-action="decrease"><i class="fas fa-minus-circle"></i></button>
                            <span class="font-bold w-5 text-center text-sm">${cartItem.quantity}</span>
                            <button class="qty-change-btn text-green-500" data-index="${index}" data-action="increase"><i class="fas fa-plus-circle"></i></button>
                        </div>
                    </div>`;
                cartItemsContainer.appendChild(itemEl);
            });
            checkoutButton.disabled = false;
            floatingCartButton.classList.remove('hidden');
        }

        cartSubtotalEl.textContent = `R$ ${formatCurrency(subtotal)}`;
        cartTotalEl.textContent = `R$ ${formatCurrency(finalTotal)}`;
        floatingCartTotal.textContent = `R$ ${formatCurrency(finalTotal)}`;
        
        document.querySelectorAll('.qty-change-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const index = parseInt(e.currentTarget.dataset.index);
                const action = e.currentTarget.dataset.action;
                if (action === 'increase') { cart[index].quantity++; }
                else if (action === 'decrease') {
                    cart[index].quantity--;
                    if (cart[index].quantity === 0) { cart.splice(index, 1); }
                }
                updateCart();
            });
        });
    }

    function applyCoupon() {
        const code = couponInput.value.toUpperCase();
        if (validCoupons[code]) {
            appliedCoupon = { ...validCoupons[code], code: code };
            couponMessage.textContent = 'Cupom de 10% aplicado!';
            couponMessage.classList.remove('text-red-500'); couponMessage.classList.add('text-green-600');
        } else {
            appliedCoupon = null;
            couponMessage.textContent = 'Cupom inválido.';
            couponMessage.classList.add('text-red-500'); couponMessage.classList.remove('text-green-600');
        }
        updateCart();
    }

    function addToCart(item) {
        const itemIdentifier = item.nome + (item.desc || '');
        const existingItem = cart.find(cartItem => cartItem.id === itemIdentifier);
        if (existingItem) { existingItem.quantity++; } 
        else { cart.push({ product: item, quantity: 1, id: itemIdentifier }); }
        updateCart();
    }
    
    const tabs = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('tab-active'));
            tab.classList.add('tab-active');
            const target = document.getElementById(tab.dataset.tab);
            tabContents.forEach(content => content.classList.add('hidden'));
            target.classList.remove('hidden');
        });
    });
    
    function updateBordaOptions() {
        if (!pizzaSizesEl.value) return;
        const selectedSize = data.pizzas.tamanhos[pizzaSizesEl.value];
        bordaRecheadaEl.innerHTML = '';
        data.pizzas.bordas.forEach((borda, index) => {
            let currentPrice = borda.precoPadrao;
            if (selectedSize.nome.includes('Mega')) { currentPrice = borda.precoMega; } 
            else if (selectedSize.nome.includes('Média')) { currentPrice = borda.precoMedia; } 
            else if (selectedSize.nome.includes('Individual')) { currentPrice = borda.precoIndividual; }
            const priceText = currentPrice > 0 ? `+ R$ ${formatCurrency(currentPrice)}` : '';
            bordaRecheadaEl.innerHTML += `<option value="${index}">${borda.nome} ${priceText}</option>`;
        });
    }

    function renderSodaSelection() {
        if (!pizzaSizesEl.value) return;
        const selectedSize = data.pizzas.tamanhos[pizzaSizesEl.value];
        sodaSelectionContainer.innerHTML = '';
        if (!selectedSize.sodasInclusas || selectedSize.sodasInclusas === 0) {
            updatePizzaSummary();
            return;
        }
        for (let i = 1; i <= selectedSize.sodasInclusas; i++) {
            let sodaHtml = `<div class="mb-4"><label class="block font-semibold mb-2 text-gray-700">Escolha seu ${i}º Refrigerante:</label><select name="pizza-soda" class="pizza-soda-select w-full p-2 border border-gray-300 rounded-md">`;
            data.refrigerantesPromo.forEach(soda => {
                const priceText = soda.precoAdicional > 0 ? ` (+ R$ ${formatCurrency(soda.precoAdicional)})` : '';
                sodaHtml += `<option value="${soda.nome}" data-price="${soda.precoAdicional}">${soda.nome}${priceText}</option>`;
            });
            sodaHtml += `</select></div>`;
            sodaSelectionContainer.innerHTML += sodaHtml;
        }
        document.querySelectorAll('.pizza-soda-select').forEach(select => {
            select.addEventListener('change', updatePizzaSummary);
        });
        updatePizzaSummary();
    }

    function populatePizzaOptions() {
        if (!pizzaSizesEl) return;
        pizzaSizesEl.innerHTML = '';
        flavorsAccordion.innerHTML = '';
        data.pizzas.tamanhos.forEach((t, i) => {
            pizzaSizesEl.innerHTML += `<option value="${i}">${t.nome} (até ${t.maxSabores} ${t.maxSabores > 1 ? 'sabores' : 'sabor'})</option>`;
        });
        updateBordaOptions();
        const allFlavors = {
            "Sabores Salgados 🍕": data.pizzas.saboresSalgados,
            "Sabores Doces 🍰": data.pizzas.saboresDoces
        };
        for (const category in allFlavors) {
            let accordionHtml = `
            <div>
                <button type="button" class="w-full flex justify-between items-center p-3 font-semibold text-left bg-gray-100 rounded-lg hover:bg-gray-200" onclick="this.nextElementSibling.classList.toggle('hidden')">
                    <span>${category}</span><i class="fas fa-chevron-down transform transition-transform"></i>
                </button>
                <div class="hidden pt-2 pb-4 px-2 space-y-2 grid grid-cols-2 gap-3 custom-scroll rounded bg-gray-50 shadow-inner">`;
            allFlavors[category].sort().forEach(flavor => {
                accordionHtml += `<label class="flex items-center p-2 rounded-md hover:bg-yellow-100"><input type="checkbox" class="flavor-checkbox h-4 w-4 rounded border-gray-300 text-red-600"><span class="ml-2 text-gray-700 text-sm">${flavor}</span></label>`;
            });
            accordionHtml += `</div></div>`;
            flavorsAccordion.innerHTML += accordionHtml;
        }
    }

    function updatePizzaSummary() {
        if (!buildPizzaForm) return;
        const selectedSize = data.pizzas.tamanhos[pizzaSizesEl.value];
        const selectedBorda = data.pizzas.bordas[bordaRecheadaEl.value];
        summarySizeEl.textContent = selectedSize.nome;
        summaryBordaEl.textContent = selectedBorda.nome;
        let selectedFlavors = Array.from(document.querySelectorAll('#flavorsAccordion .flavor-checkbox:checked')).map(cb => cb.nextElementSibling.textContent);
        if (selectedFlavors.length > selectedSize.maxSabores) {
            flavorWarningEl.textContent = `Máximo de ${selectedSize.maxSabores} ${selectedSize.maxSabores > 1 ? 'sabores' : 'sabor'}!`;
            flavorWarningEl.classList.remove('hidden');
            const lastChecked = Array.from(document.querySelectorAll('#flavorsAccordion .flavor-checkbox:checked')).pop();
            if (lastChecked) lastChecked.checked = false;
            selectedFlavors = Array.from(document.querySelectorAll('#flavorsAccordion .flavor-checkbox:checked')).map(cb => cb.nextElementSibling.textContent);
        } else {
            flavorWarningEl.classList.add('hidden');
        }
        summaryFlavorsEl.innerHTML = selectedFlavors.length > 0 ? selectedFlavors.map(f => `<li>${f}</li>`).join('') : `<li>Selecione...</li>`;
        let total = selectedSize.preco;
        let currentBordaPrice = selectedBorda.precoPadrao;
        if (selectedSize.nome.includes('Mega')) { currentBordaPrice = selectedBorda.precoMega; } 
        else if (selectedSize.nome.includes('Média')) { currentBordaPrice = selectedBorda.precoMedia; } 
        else if (selectedSize.nome.includes('Individual')) { currentBordaPrice = selectedBorda.precoIndividual; }
        total += currentBordaPrice;
        let sodaPrice = 0;
        const selectedSodas = [];
        document.querySelectorAll('.pizza-soda-select').forEach(select => {
            const selectedOption = select.options[select.selectedIndex];
            sodaPrice += parseFloat(selectedOption.dataset.price);
            selectedSodas.push(selectedOption.value);
        });
        if (selectedSodas.length > 0) {
            summarySodaContainer.classList.remove('hidden');
            summarySoda.textContent = selectedSodas.join(', ');
        } else {
            summarySodaContainer.classList.add('hidden');
        }
        total += sodaPrice;
        pizzaTotalEl.textContent = formatCurrency(total);
    }

    if (buildPizzaForm) {
        buildPizzaForm.addEventListener('submit', e => {
            e.preventDefault();
            const selectedSize = data.pizzas.tamanhos[pizzaSizesEl.value];
            const selectedBorda = data.pizzas.bordas[bordaRecheadaEl.value];
            const selectedFlavors = Array.from(document.querySelectorAll('#flavorsAccordion .flavor-checkbox:checked')).map(cb => cb.nextElementSibling.textContent);
            if (selectedFlavors.length === 0) return alert('Por favor, escolha pelo menos um sabor!');
            let description = [];
            let finalPrice = selectedSize.preco;
            let currentBordaPrice = selectedBorda.precoPadrao;
            if (selectedSize.nome.includes('Mega')) { currentBordaPrice = selectedBorda.precoMega; } 
            else if (selectedSize.nome.includes('Média')) { currentBordaPrice = selectedBorda.precoMedia; } 
            else if (selectedSize.nome.includes('Individual')) { currentBordaPrice = selectedBorda.precoIndividual; }
            finalPrice += currentBordaPrice;
            if (currentBordaPrice > 0) { description.push(`Borda: ${selectedBorda.nome}`); }
            const selectedSodas = [];
            document.querySelectorAll('.pizza-soda-select').forEach(select => {
                const selectedOption = select.options[select.selectedIndex];
                finalPrice += parseFloat(selectedOption.dataset.price);
                selectedSodas.push(selectedOption.value);
            });
            if (selectedSodas.length > 0) { description.push(`Bebida(s): ${selectedSodas.join(', ')}`); }
            addToCart({ nome: `Pizza ${selectedSize.nome.split(' ')[0]} (${selectedFlavors.join(', ')})`, desc: description.join(' | '), preco: finalPrice });
            buildPizzaForm.reset();
            document.querySelectorAll('.flavor-checkbox').forEach(cb => { cb.checked = false; });
            renderSodaSelection();
            updatePizzaSummary();
        });
        pizzaSizesEl.addEventListener('change', () => { updateBordaOptions(); renderSodaSelection(); });
        bordaRecheadaEl.addEventListener('change', updatePizzaSummary);
        flavorsAccordion.addEventListener('change', updatePizzaSummary);
    }
    
    function openPromoModal(promoItem) {
        const selectionContainer = document.getElementById('promoSelectionContainer');
        selectionContainer.innerHTML = '';
        document.getElementById('promoModalTitle').textContent = `Personalize: ${promoItem.nome}`;
        if (promoItem.needsFlavor) {
            promoItem.pizzas.forEach((pizza, index) => {
                let pizzaHtml = `<div class="border p-4 rounded-lg"><h4 class="font-bold text-lg mb-2">🍕 Pizza ${pizza.size} (até ${pizza.maxSabores} sabores)</h4><div class="grid grid-cols-2 gap-2 promo-flavor-group" data-max-flavors="${pizza.maxSabores}" data-pizza-index="${index}">`;
                data.pizzas.saboresSalgados.sort().forEach(flavor => {
                    pizzaHtml += `<label class="flex items-center p-2 rounded-md hover:bg-yellow-100"><input type="checkbox" class="promo-flavor-checkbox h-4 w-4 rounded border-gray-300 text-red-600"><span class="ml-2 text-sm text-gray-700">${flavor}</span></label>`;
                });
                pizzaHtml += `</div><p class="text-red-600 text-sm mt-2 hidden" id="promo-warning-${index}"></p></div>`;
                selectionContainer.innerHTML += pizzaHtml;
            });
        }
        if (promoItem.includesSweet) {
            let sweetPizzaHtml = '<div class="border p-4 rounded-lg"><h4 class="font-bold text-lg mb-2">🍰 Pizza Doce Individual (Grátis)</h4><div class="grid grid-cols-2 gap-2">';
            data.pizzas.saboresDoces.sort().forEach(flavor => {
                sweetPizzaHtml += `<label class="flex items-center p-2 rounded-md hover:bg-yellow-100"><input type="radio" name="sweet-flavor" value="${flavor}" class="h-4 w-4 border-gray-300 text-red-600"><span class="ml-2 text-sm text-gray-700">${flavor}</span></label>`;
            });
            sweetPizzaHtml += "</div></div>";
            selectionContainer.innerHTML += sweetPizzaHtml;
        }
        if (promoItem.includesSoda) {
            let sodaHtml = '<div class="border p-4 rounded-lg"><h4 class="font-bold text-lg mb-2">🥤 Escolha seu Refrigerante</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-2">';
            data.refrigerantesPromo.forEach((soda, index) => {
                const priceText = soda.precoAdicional > 0 ? ` (+ R$ ${formatCurrency(soda.precoAdicional)})` : "";
                sodaHtml += `<label class="flex items-center p-2 rounded-md hover:bg-yellow-100"><input type="radio" name="promo-soda" value="${soda.nome}" data-price="${soda.precoAdicional}" class="h-4 w-4 border-gray-300 text-red-600" ${index === 0 ? "checked" : ""}><span class="ml-2 text-sm text-gray-700">${soda.nome}${priceText}</span></label>`;
            });
            sodaHtml += "</div></div>";
            selectionContainer.innerHTML += sodaHtml;
        }
        promoModal.classList.remove("hidden");
        promoForm.dataset.promoItem = JSON.stringify(promoItem);
    }

    function openMassaModal(massaItem) {
        const selectionContainer = document.getElementById('massaSelectionContainer');
        const massaTotalEl = document.getElementById('massaTotal');
        document.getElementById('massaModalTitle').textContent = `Personalize: ${massaItem.nome}`;
        let content = `<div class="border p-4 rounded-lg"><h4 class="font-bold text-lg mb-2">1. Escolha o Tamanho</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-2">`;
        data.massaSizes.forEach((size, index) => {
            content += `<label class="flex items-center p-2 rounded-md hover:bg-yellow-100"><input type="radio" name="massa-size" value="${index}" data-price="${size.preco}" class="h-4 w-4" ${index === 0 ? 'checked' : ''}><span class="ml-2 text-sm">${size.nome}</span></label>`;
        });
        content += '</div></div>';
        content += '<div class="border p-4 rounded-lg"><h4 class="font-bold text-lg mb-2">2. Escolha o Molho</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-2">';
        data.molhosMassas.forEach((molho, index) => {
            content += `<label class="flex items-center p-2 rounded-md hover:bg-yellow-100"><input type="radio" name="massa-molho" value="${molho.nome}" class="h-4 w-4" ${index === 0 ? 'checked' : ''}><span class="ml-2 text-sm">${molho.nome}</span></label>`;
        });
        content += '</div></div>';
        content += '<div class="border p-4 rounded-lg"><h4 class="font-bold text-lg mb-2">3. Escolha a Proteína</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-2">';
        data.proteinasMassas.forEach((proteina, index) => {
            const priceText = proteina.precoAdicional > 0 ? ` (+ R$ ${formatCurrency(proteina.precoAdicional)})` : '';
            content += `<label class="flex items-center p-2 rounded-md hover:bg-yellow-100"><input type="radio" name="massa-proteina" value="${index}" data-price="${proteina.precoAdicional}" class="h-4 w-4" ${index === 0 ? 'checked' : ''}><span class="ml-2 text-sm">${proteina.nome}${priceText}</span></label>`;
        });
        content += '</div></div>';
        content += '<div class="border p-4 rounded-lg"><h4 class="font-bold text-lg mb-2">4. Ingredientes (Escolha até 8)</h4><div class="grid grid-cols-2 gap-2">';
        data.ingredientesMassas.forEach((ing, index) => {
            content += `<label class="flex items-center p-2 rounded-md hover:bg-yellow-100"><input type="checkbox" name="massa-ingrediente" value="${index}" data-price="${ing.precoAdicional}" class="h-4 w-4 massa-ingrediente-checkbox"><span class="ml-2 text-xs">${ing.nome} (+${formatCurrency(ing.precoAdicional)})</span></label>`;
        });
        content += '</div><p id="massa-ingrediente-warning" class="text-red-600 text-sm mt-2 hidden"></p></div>';
        selectionContainer.innerHTML = content;
        
        const updateMassaTotal = () => {
            let total = 0;
            const selectedSize = document.querySelector('input[name="massa-size"]:checked');
            if (selectedSize) total += parseFloat(selectedSize.dataset.price);

            const selectedProteina = document.querySelector('input[name="massa-proteina"]:checked');
            if (selectedProteina) total += parseFloat(selectedProteina.dataset.price);

            const warningEl = document.getElementById("massa-ingrediente-warning");
            const selectedIngredientes = document.querySelectorAll('input[name="massa-ingrediente"]:checked');
            
            if (selectedIngredientes.length > 8) {
                warningEl.textContent = "Você só pode escolher até 8 ingredientes.";
                warningEl.classList.remove("hidden");
                selectedIngredientes[selectedIngredientes.length - 1].checked = false; 
            } else {
                warningEl.classList.add("hidden");
            }

            document.querySelectorAll('input[name="massa-ingrediente"]:checked').forEach(checkbox => {
                total += parseFloat(checkbox.dataset.price);
            });

            massaTotalEl.textContent = formatCurrency(total);
        };
        
        selectionContainer.addEventListener('change', updateMassaTotal);
        updateMassaTotal();

        massaModal.classList.remove('hidden');
        massaForm.dataset.massaItem = JSON.stringify(massaItem);
    }

    function openEsfihaComboModal(comboItem){const selectionContainer=document.getElementById("esfihaComboSelectionContainer"),sodaContainer=document.getElementById("esfihaComboSodaContainer"),modalTitle=document.getElementById("esfihaComboModalTitle"),totalQtyEl=document.getElementById("esfihaTotalQty"),counterEl=document.getElementById("esfihaCounter");modalTitle.textContent=`Personalize: ${comboItem.nome}`,totalQtyEl.textContent=comboItem.quantidade,counterEl.textContent="0",selectionContainer.innerHTML="",sodaContainer.innerHTML="";let content=`<div class="border p-4 rounded-lg"><h4 class="font-bold text-lg mb-2">Escolha os sabores (Total: ${comboItem.quantidade})</h4><div class="space-y-3">`;data.esfihas.saboresComPreco.forEach((esfiha,index)=>{const priceText=esfiha.precoAdicional>0?` (+ R$ ${formatCurrency(esfiha.precoAdicional)})`:"";content+=`
 <div class="flex justify-between items-center p-2 rounded-md bg-gray-50">
 <span class="text-sm text-gray-700">${esfiha.nome}${priceText}</span>
 <div class="flex items-center gap-2 border rounded-md p-1">
 <button type="button" class="esfiha-qty-change text-red-500" data-index="${index}" data-action="decrease"><i class="fas fa-minus-circle"></i></button>
 <input type="number" readonly value="0" min="0" class="esfiha-qty-input w-8 text-center bg-transparent font-bold" data-index="${index}">
 <button type="button" class="esfiha-qty-change text-green-500" data-index="${index}" data-action="increase"><i class="fas fa-plus-circle"></i></button>
 </div>
 </div>`}),content+="</div></div>",selectionContainer.innerHTML=content,comboItem.includesSoda&&(()=>{let sodaHtml='<div class="border p-4 rounded-lg"><h4 class="font-bold text-lg mb-2">🥤 Escolha seu Refrigerante</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-2">';data.refrigerantesPromo.forEach((soda,index)=>{const priceText=soda.precoAdicional>0?` (+ R$ ${formatCurrency(soda.precoAdicional)})`:"";sodaHtml+=`<label class="flex items-center p-2 rounded-md hover:bg-yellow-100"><input type="radio" name="esfiha-combo-soda" value="${soda.nome}" data-price="${soda.precoAdicional}" class="h-4 w-4 border-gray-300 text-red-600" ${0===index?"checked":""}><span class="ml-2 text-sm text-gray-700">${soda.nome}${priceText}</span></label>`}),sodaHtml+="</div></div>",sodaContainer.innerHTML+=sodaHtml})();const updateEsfihaComboTotal=()=>{let total=comboItem.preco,currentCount=0;document.querySelectorAll(".esfiha-qty-input").forEach(input=>{const qty=parseInt(input.value);if(currentCount+=qty,qty>0){const esfihaIndex=parseInt(input.dataset.index);total+=data.esfihas.saboresComPreco[esfihaIndex].precoAdicional*qty}}),comboItem.includesSoda&&(()=>{const selectedSoda=document.querySelector('input[name="esfiha-combo-soda"]:checked');selectedSoda&&(total+=parseFloat(selectedSoda.dataset.price))})(),counterEl.textContent=currentCount,document.getElementById("esfihaComboTotal").textContent=formatCurrency(total);const warningEl=document.getElementById("esfihaWarning");currentCount>comboItem.quantidade?(warningEl.textContent=`Você selecionou ${currentCount} esfihas, o limite para este combo é ${comboItem.quantidade}.`,warningEl.classList.remove("hidden")):warningEl.classList.add("hidden")};selectionContainer.addEventListener("click",e=>{const btn=e.target.closest(".esfiha-qty-change");if(!btn)return;const action=btn.dataset.action,index=btn.dataset.index,input=document.querySelector(`.esfiha-qty-input[data-index="${index}"]`);let currentValue=parseInt(input.value);"increase"===action?input.value=currentValue+1:"decrease"===action&&currentValue>0&&(input.value=currentValue-1),updateEsfihaComboTotal()}),sodaContainer&&sodaContainer.addEventListener("change",updateEsfihaComboTotal),updateEsfihaComboTotal(),esfihaComboModal.classList.remove("hidden"),esfihaComboForm.dataset.comboItem=JSON.stringify(comboItem)}
    document.body.addEventListener('change', e => { if (e.target.classList.contains('promo-flavor-checkbox')) { const group = e.target.closest('.promo-flavor-group'); if (!group) return; const maxFlavors = parseInt(group.dataset.maxFlavors); const pizzaIndex = group.dataset.pizzaIndex; const warningEl = document.getElementById(`promo-warning-${pizzaIndex}`); const checkedBoxes = group.querySelectorAll('.promo-flavor-checkbox:checked'); if (checkedBoxes.length > maxFlavors) { e.target.checked = false; warningEl.textContent = `Máximo de ${maxFlavors} sabores para esta pizza.`; warningEl.classList.remove('hidden'); } else { warningEl.classList.add('hidden'); } } });
    promoForm.addEventListener('submit', e => { e.preventDefault(); const promoItem = JSON.parse(e.currentTarget.dataset.promoItem); let description = []; let allSelectionsMade = true; let finalPrice = promoItem.preco; if (promoItem.needsFlavor) { promoItem.pizzas.forEach((pizza, index) => { const group = document.querySelector(`#promoSelectionContainer .promo-flavor-group[data-pizza-index="${index}"]`); const selectedFlavors = Array.from(group.querySelectorAll('.promo-flavor-checkbox:checked')).map(cb => cb.nextElementSibling.textContent); if (selectedFlavors.length === 0) allSelectionsMade = false; description.push(`Pizza ${pizza.size}: ${selectedFlavors.join(', ')}`); }); } if (promoItem.includesSweet) { const selectedSweet = document.querySelector('input[name="sweet-flavor"]:checked'); if (selectedSweet) { description.push(`Pizza Doce: ${selectedSweet.value}`); } else { allSelectionsMade = false; } } if (promoItem.includesSoda) { const selectedSoda = document.querySelector('input[name="promo-soda"]:checked'); if (selectedSoda) { description.push(`Bebida: ${selectedSoda.value}`); finalPrice += parseFloat(selectedSoda.dataset.price); } else { allSelectionsMade = false; } } if (!allSelectionsMade) { return alert('Por favor, faça todas as seleções necessárias.'); } addToCart({ nome: promoItem.nome, desc: description.join(' | '), preco: finalPrice }); promoModal.classList.add('hidden'); });
    massaForm.addEventListener('submit', e => { e.preventDefault(); const massaItem = JSON.parse(e.currentTarget.dataset.massaItem); const selectedSize = data.massaSizes[document.querySelector('input[name="massa-size"]:checked').value]; const selectedMolho = document.querySelector('input[name="massa-molho"]:checked'); const selectedProteina = data.proteinasMassas[document.querySelector('input[name="massa-proteina"]:checked').value]; if (!selectedMolho || !selectedProteina) { return alert('Por favor, escolha o molho e a proteína.'); } let finalPrice = selectedSize.preco + selectedProteina.precoAdicional; let description = [`Tamanho: ${selectedSize.nome}`, `Molho: ${selectedMolho.value}`, `Proteína: ${selectedProteina.nome}`]; const ingredientesAdicionais = []; document.querySelectorAll('input[name="massa-ingrediente"]:checked').forEach(checkbox => { const ingrediente = data.ingredientesMassas[checkbox.value]; ingredientesAdicionais.push(ingrediente.nome); finalPrice += ingrediente.precoAdicional; }); if (ingredientesAdicionais.length > 0) { description.push(`Adicionais: ${ingredientesAdicionais.join(', ')}`); } addToCart({ nome: `Massa ${massaItem.nome}`, desc: description.join(' | '), preco: finalPrice }); massaModal.classList.add('hidden'); });
    esfihaComboForm.addEventListener('submit', e => { e.preventDefault(); const comboItem = JSON.parse(e.currentTarget.dataset.comboItem); let description = []; let finalPrice = comboItem.preco; let totalQty = 0; document.querySelectorAll('.esfiha-qty-input').forEach(input => { const qty = parseInt(input.value); if (qty > 0) { const esfihaIndex = parseInt(input.dataset.index); const esfiha = data.esfihas.saboresComPreco[esfihaIndex]; description.push(`${qty}x ${esfiha.nome}`); finalPrice += esfiha.precoAdicional * qty; totalQty += qty; } }); if (totalQty !== comboItem.quantidade) { return alert(`Você deve selecionar exatamente ${comboItem.quantidade} esfihas. Você selecionou ${totalQty}.`); } if (comboItem.includesSoda) { const selectedSoda = document.querySelector('input[name="esfiha-combo-soda"]:checked'); if (selectedSoda) { description.push(`Bebida: ${selectedSoda.value}`); finalPrice += parseFloat(selectedSoda.dataset.price); } else { return alert('Por favor, escolha uma bebida para o combo.'); } } addToCart({ nome: comboItem.nome, desc: description.join(', '), preco: finalPrice }); esfihaComboModal.classList.add('hidden'); });

    document.body.addEventListener('click', (e) => {
        const target = e.target.closest('button');
        if (!target) return;
        if (target.classList.contains('open-promo-modal-btn')) openPromoModal(JSON.parse(target.dataset.item));
        else if (target.classList.contains('add-to-cart-btn')) addToCart(JSON.parse(target.dataset.item));
        else if (target.classList.contains('open-massa-modal-btn')) openMassaModal(JSON.parse(target.dataset.item));
        else if (target.classList.contains('open-esfiha-combo-modal-btn')) openEsfihaComboModal(JSON.parse(target.dataset.item));
    });
    applyCouponBtn.addEventListener('click', applyCoupon);
    checkoutButton.addEventListener('click', () => {
        cartModal.classList.add('hidden');
        checkoutModal.classList.remove('hidden');
    });
    cancelButton.addEventListener('click', () => checkoutModal.classList.add('hidden'));
    floatingCartButton.addEventListener('click', () => cartModal.classList.remove('hidden'));
    closeCartModal.addEventListener('click', () => cartModal.classList.add('hidden'));
    cancelPromo.addEventListener('click', () => promoModal.classList.add('hidden'));
    cancelMassa.addEventListener('click', () => massaModal.classList.add('hidden'));
    cancelEsfihaCombo.addEventListener('click', () => esfihaComboModal.classList.add('hidden'));

    customerInfoForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const orderNumber = Math.floor(1000 + Math.random() * 9000);
        const customerName = document.getElementById('customerName').value;
        const customerAddress = document.getElementById('customerAddress').value;
        const customerNeighborhood = document.getElementById('customerNeighborhood').value;
        const paymentMethod = document.getElementById('paymentMethod').value;
        const customerObs = document.getElementById('customerObs').value;
        const ketchupQty = document.getElementById('ketchupQty').value;
        const mustardQty = document.getElementById('mustardQty').value;
        const subtotal = cart.reduce((sum, cartItem) => sum + (cartItem.product.preco * cartItem.quantity), 0);
        let discount = 0;
        if (appliedCoupon) { if (appliedCoupon.type === 'percentage') { discount = subtotal * (appliedCoupon.value / 100); } }
        const totalAfterDiscount = subtotal - discount;
        let deliveryFee = 0;
        if (totalAfterDiscount > 0 && totalAfterDiscount < 35.00) { deliveryFee = 8.00; }
        const finalTotal = totalAfterDiscount + deliveryFee;
        const MAX_WIDTH = 42;
        const SEPARATOR = '-'.repeat(MAX_WIDTH);
        const formatLine = (label, value) => { const remainingSpace = MAX_WIDTH - label.length - value.length; if (remainingSpace < 1) { return `${label}\n${value.padStart(MAX_WIDTH, ' ')}`; } return `${label}${'.'.repeat(remainingSpace)}${value}`; };
        let message = `*PEDIDO SUPER PIZZA*\n`;
        message += `*PEDIDO Nº:* ${orderNumber}\n`;
        message += `${SEPARATOR}\n`;
        message += `*CLIENTE:* ${customerName}\n`;
        message += `*ENDEREÇO:* ${customerAddress}, ${customerNeighborhood}\n`;
        message += `${SEPARATOR}\n\n*RESUMO DO PEDIDO*\n`;
        cart.forEach(cartItem => {
            message += `${SEPARATOR}\n`;
            message += `*${cartItem.quantity}x ${cartItem.product.nome}*\n`;
            if (cartItem.product.desc) { const details = cartItem.product.desc.split('|').map(d => d.trim()); details.forEach(detail => { message += `  _${detail}_\n`; }); }
            const itemTotalText = `R$ ${formatCurrency(cartItem.product.preco * cartItem.quantity)}`;
            message += `${itemTotalText.padStart(MAX_WIDTH, ' ')}\n`;
        });
        message += `${SEPARATOR}\n\n`;
        message += formatLine('Subtotal', `R$ ${formatCurrency(subtotal)}`) + '\n';
        if (discount > 0) { message += formatLine(`Desconto (${appliedCoupon.code})`, `- R$ ${formatCurrency(discount)}`) + '\n'; }
        if (deliveryFee > 0) { message += formatLine('Taxa de Entrega', `R$ ${formatCurrency(deliveryFee)}`) + '\n'; }
        message += `${SEPARATOR}\n`;
        message += `*${formatLine('TOTAL A PAGAR', `R$ ${formatCurrency(finalTotal)}`)}*\n`;
        message += `${SEPARATOR}\n\n`;
        if (customerObs) { message += `*OBS:* ${customerObs}\n`; }
        if (ketchupQty > 0 || mustardQty > 0) {
            let sachets = [];
            if (ketchupQty > 0) sachets.push(`${ketchupQty}x Ketchup`);
            if (mustardQty > 0) sachets.push(`${mustardQty}x Mostarda`);
            message += `*SACHÊS:* ${sachets.join(', ')}\n`;
        }
        message += `\n*FORMA DE PAGAMENTO:* ${paymentMethod}\n`;
        const whatsappNumber = "5521981417594"; // SEU NÚMERO AQUI
        const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
        checkoutModal.classList.add('hidden');
        customerInfoForm.reset();
        cart = [];
        updateCart();
    });

    // INICIALIZAÇÃO
    if (buildPizzaForm) { populatePizzaOptions(); renderSodaSelection(); updatePizzaSummary(); }
    createMenuSection('Nossas Ofertas Imperdíveis! 🔥', data.promocoes, 'promocoes');
    createMenuSection('Nossas Massas Artesanais 🍝', data.massas, 'massas');
    createMenuSection('Nossos Hambúrgueres Suculentos 🍔', data.hamburgueres, 'hamburgueres');
    createEsfihasSection();
    createMenuSection('Combos & Petiscos 🍟', data.combos, 'combos');
    createMenuSection('Bebidas Geladinhas 🥤', data.bebidas, 'bebidas');
    createContatoSection();
    updateCart();
});
</script>
</body>
</html>
